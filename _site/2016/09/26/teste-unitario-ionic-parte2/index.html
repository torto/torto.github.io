<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta content="Teste unitário em Ionic - Services - Parte 2" name="title">
    <meta content="Entendendo como Jasmine funciona e testando seu primeiro Service." name="description">
    <meta content="http://torto.github.io/img/unity-test-ionic/part2.jpg" name="preview">
    <!-- Open Graph data -->
    <meta content="Teste unitário em Ionic - Services - Parte 2" property="og:title">
    <meta content="Entendendo como Jasmine funciona e testando seu primeiro Service." property="og:description">
    <meta content="http://torto.github.io/2016/09/26/teste-unitario-ionic-parte2/" property="og:url">
    <meta content="http://torto.github.io/img/unity-test-ionic/part2.jpg" property="og:image">
    <!-- g+ -->
    <meta content="Teste unitário em Ionic - Services - Parte 2" itemprop="name">
    <meta content="Entendendo como Jasmine funciona e testando seu primeiro Service." itemprop="description">
    <meta content="http://torto.github.io/img/unity-test-ionic/part2.jpg" itemprop="image">

    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">

    <title>Teste unitário em Ionic - Services - Parte 2 - Torto Blog</title>



    <link rel="canonical" href="http://torto.github.io/2016/09/26/teste-unitario-ionic-parte2/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- jQuery -->
    <script src="/js/jquery.min.js "></script>
    <link rel="stylesheet" type="text/css" href="/css/jgallery.min.css" />
     <script type="text/javascript" src="/js/jgallery.min.js"></script>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63612158-1', 'auto');
  ga('send', 'pageview');

</script>

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Torto Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="/">Home</a>
                </li>
                
                <li>
                    <a href="/about/">Sobre</a>
                </li>
                
                <li>
                  <a href="/curriculo">Currículo</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('/img/top-ionic.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Teste unitário em Ionic - Services - Parte 2</h1>
                    
                    <h2 class="subheading">Entendendo como Jasmine funciona e testando seu primeiro Service.</h2>
                    
                    <span class="meta">Posted by Torto on September 26, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h3 id="introduo">Introdução</h3>

<p>Muito bom meu amigo, se você chegou aqui significa que você quer ser um programador melhor, poderia ficar horas discorrendo dos benefícios do teste, mas caso você esta aqui significa que já sabe os benefícios que teste automatizado pode trazer para a sua vida.</p>

<p>Mesmo sabendo disso muitas pessoas se sentem perdidas em como e oque testar em seus sistemas, posso ser utópico e dizer que você <strong>deve testar TUDO ter um coverage de 100%</strong>, mas será que se faz necessário isso? Sim faz AhhahAA, mas sei que no dia-a-dia fazer um coverage de 100% é meio difícil, pelo motivo principal: <strong>cód. legado</strong> e muitos outros fatores.</p>

<p>Mas não se desespere meu amigo, fazer teste é uma coisa que demora de fato a aprender e na persistência você realmente vai aprender, então o melhor e principal passo para começar a testar é fazer os testes mesmo errando, nesse post vou dar algumas dicas que utilizo para conseguir fazer os testes espero que ajude você nesse divisor de águas que são os testes automatizados.</p>

<h3 id="sequncia-de-posts">Sequência de posts</h3>

<ul>
  <li><a href="http://torto.github.io/2016/09/25/teste-unitario-ionic/">Teste unitário em Ionic - Parte 1</a></li>
  <li><strong>Teste unitário em Ionic - Services - Parte 2</strong></li>
  <li><em>Teste unitário em Ionic - Controllers - Parte 3</em></li>
  <li><em>Teste unitário em Ionic - Directives - Parte 4</em></li>
</ul>

<h3 id="testando-um-service">Testando um Service</h3>

<p>Neste post vou ensinar a testar um Service do AngularJs, para efeito prático usarei o exemplo padrão que vem no Ionic, nesse exemplo é simulado um app de chat, no service da aplicação existe um array com todas as mensagens e três métodos, um para pegar todas as mensagens(all), outro para pegar uma mensagem específica(get) e o último para remover uma mensagem(remove).</p>

<p>Então vamos lá, esse é o cód. do service:</p>

<script src="//pastebin.com/embed_js/xKZ4dR66"></script>

<p>Simples né? Para testar é mais simples ainda. Sei que a maneira mais correta seria criar primeiro os testes para depois desenvolver, mas como esse artigo é focado para iniciantes sei da dificuldade de aprender a testar començando pelos testes para depois ir para o cód., sendo assim esse post e o próximo serão dessa forma e no último post da série eu faço da maneira correta para vocês conseguirem compreender melhor.</p>

<p>Primeiro vamos criar nossa estrutura de pastas e o arquivo JSON para simular o array de chats do service. Dentro da pasta <code class="highlighter-rouge">test</code> vamos criar as pastas baseado nas rotas do angular, então a primeira pasta a ser criada é <code class="highlighter-rouge">tabs</code>, e nessa pasta inserimos o nosso arquivo de dados <code class="highlighter-rouge">data.json</code> que nele conterá o mesmo array de objetos da variável <code class="highlighter-rouge">chats</code> do nosso service:</p>

<script src="//pastebin.com/embed_js/x0D1JrDJ"></script>

<p>Sabemos que existe três funções, vamos escolher a do método .all() para iniciar nossos testes, primeiro vamos configurar nosso arquivo de teste para conseguir mockar nosso service, para isso é preciso entender como funciona o teste com Jasmine.</p>

<p>Para iniciar é preciso setar um <code class="highlighter-rouge">describe</code>, nele existe dois parâmetros, o primeiro é uma String, nela você vai colocar qual o significado daquele teste, o segundo parâmetro é uma function(), dentro dela você iniciará seus testes.
Para iniciar seus asserts é preciso criar outro método e ele se chama <code class="highlighter-rouge">it</code>, tem as mesmas características do <code class="highlighter-rouge">describe</code>, uma String e uma função, agora sim dentro dessa função você vai passar seus <code class="highlighter-rouge">expect</code>. Você pode ficar confuso no início com tudo isso mas depois se acostuma.</p>

<p>Então vamos criar um arquivo dentro da pasta <code class="highlighter-rouge">tabs</code> chamado: <code class="highlighter-rouge">ChatServiceTest.js</code> e segue o cód. inicial dos testes:</p>

<script src="//pastebin.com/embed_js/4WWc14Ua"></script>

<p>Nesse momento apenas estruturamos nosso arquivo de teste para que possamos iniciar nossos <code class="highlighter-rouge">asserts</code>, o primeiro <code class="highlighter-rouge">describe</code> coloco uma descrição de qual é o nome do nosso service, as próximas três linhas são as configurações para pegar o arquivo json e inserir numa variável, o <code class="highlighter-rouge">beforeEach</code> executará todas as vezes antes de executar cada <code class="highlighter-rouge">describe</code> e <code class="highlighter-rouge">it</code>.</p>

<p>No <code class="highlighter-rouge">beforeEach</code> no injetamos no teste os nossos modulos da aplicação, como nosso service é independente, ou seja, não há injeção de outros services nele, iremos inserir somente o <code class="highlighter-rouge">starter.services</code>, em seguida vamos injetar na nossa variável <code class="highlighter-rouge">service</code> o service que vamos testar chamado <code class="highlighter-rouge">Chats</code>, isso faz com que injetamos todos os métodos e variáveis do service requerido a essa variável (Mockamos ele &lt;3).</p>

<p>Sempre que vamos testar um conjunto de coisas parecidas criamos um <code class="highlighter-rouge">describe</code> novo, como nosso código é pequeno usaremos um único <code class="highlighter-rouge">describe</code> para testar tudo, em seguida criaremos o nosso <code class="highlighter-rouge">it</code>, lembre-se que as Strings são muito importante para você conseguir identificar em que parte seu cód. esta quebrando e essas strings na hora de exibir o erro vão se concatenar, então pense nelas como um texto &lt;3</p>

<p><img src="http://torto.github.io/img/unity-test-ionic/error.png" alt="Error in test" /></p>

<p>Agora dentro do <code class="highlighter-rouge">it</code> vamos de fato executar nosso teste, vamos verificar se os dados que o método all() retorna é o mesmo que retorna nosso arquivo json.</p>

<script src="//pastebin.com/embed_js/d8ii81sH"></script>

<p>Vamos executar o teste para ver se ele passa, basta digitar <code class="highlighter-rouge">gulp test</code> no terminal e ver se aparece o verde da alegria, deve aparecer em verde que você possui 1 teste e que esse teste passou &lt;3 e ao mesmo tempo você vai ver o relatório do coverage todo em vermelho, porque ainda falta muita coisa para testarmos &lt;3.</p>

<p>Uma dica importante é que quando executamos o teste ele gera um relatório em html na pasta <code class="highlighter-rouge">coverage</code> na pasta raiz do projeto, abra o arquivo html e veja seu service nele vai conter quantas vezes os testes passam em cada método e variável do arquivo e em vermelho lugares que ainda não testou, isso é lindo porque fica visível os lugares que faltam testar.</p>

<p>Vamos agora testar o método get(), para isso vamos criar um <code class="highlighter-rouge">it</code> e executar o método get passando o parâmetro com valor 0 e ver se retorna o primeiro valor do array, segue o cód:</p>

<script src="//pastebin.com/embed_js/8DvQ7QGd"></script>

<p>Está ficando mais fácil entender como os testes funcionam né? Então vamos testar o remove(), só gostaria de lembrar que cada teste depende muito do contexto de cada ação do seu método, então não se acanhe com o tempo você vai pegando o jeitinho &lt;3.
No nosso teste iremos excluir o primeiro valor do nosso array e verificar se nosso array mockado está diferente do array que vem do método:</p>

<script src="//pastebin.com/embed_js/bFZeqe2S"></script>

<p>Vamos agora olhar nosso coverage html, abra o link do nosso service e verifique se existe algo em vermelho. Encontrou algo em vermelho? Se sim é porque falta testar algo…
Aparece em vermelho a seguinte linha <code class="highlighter-rouge">return null</code> no método get(), ou seja, testamos a saída do método get com valores válidos apenas e esquecemos de testar caso não exista um id válido. Viu como é importante ver a saída do coverage &lt;3, vamos então adicionar um <code class="highlighter-rouge">it</code> para testar com valor de id inválido:</p>

<script src="//pastebin.com/embed_js/dj5GgZNK"></script>

<p>Se verificar o covarage novamente não vai encontrar mais nenhuma linha em vermelha &lt;3, mas já terminamos? Não, já que você identificou que valores inválidos retornam null, porque não adicionar mais um <code class="highlighter-rouge">expect</code> no teste do remove verificando se o valor 0 existe e se esta retornando null depois que removido.</p>

<script src="//pastebin.com/embed_js/YDDVLtUN"></script>

<p>Mas porque fazer isso? Já ouviu falar que o teste é a documentação do código? Então uma documentação boa é aquela que existe muitos exemplos e bem escrita, uma linha a mais não vai fazer falta para ninguém e teu cód. ficará melhor escrito.</p>

<p>Segue o <a href="https://github.com/torto/unit-test-ionic">repositório</a> do projeto inteiro. Até o próximo capitulo.</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2016/09/25/teste-unitario-ionic/" data-toggle="tooltip" data-placement="top" title="Teste unitário em Ionic - Parte 1">&larr; Previous Post</a>
                    </li>
                    
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/tortoyo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://www.facebook.com/tortoyo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/torto">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Torto Blog 2016</p>
            </div>
        </div>
    </div>
</footer>



<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
